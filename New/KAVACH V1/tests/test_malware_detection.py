import sys
import os
sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))

from src.detection_engines.malware_detector import AdvancedMalwareDetector


def test_malware_scan_returns_dict():
    md = AdvancedMalwareDetector()
    res = md.scan('file.exe')
    assert isinstance(res, dict)
    assert "file" in res
    assert "status" in res
    assert "threat" in res
    assert "timestamp" in res


def test_run_cycle_outputs_summary():
    md = AdvancedMalwareDetector()
    report = md.run_detection_cycle()
    assert isinstance(report, dict)
    assert "summary" in report
    assert "detections" in report
    assert "blocked" in report
    assert "safe" in report

    # Print readable summary
    print("\n\n🔍 KAVACH Malware Detection Simulation Output 🔍")
    print("===============================================")
    print(f"Detected Threats: {len(report['detections'])}")
    print(f"Blocked Files   : {report['blocked']}")
    print(f"Safe Files      : {report['safe']}")
    print("\nDetails:")
    for r in report["summary"]:
        print(f" → {r['file']} [{r['status']}] — Threat: {r['threat']}")
    

if __name__ == "__main__":
    test_malware_scan_returns_dict()
    test_run_cycle_outputs_summary()
